<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Leave Booking System</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    body {
      font-family: Arial, sans-serif; background: #f5f7fa; margin: 0; padding: 10px; font-size: 13px; color: #333;
    }
    .container {
      max-width: 900px; margin: 0 auto; background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    h1 { text-align: center; font-size: 18px; margin: 5px 0; color: #2c3e50; }
    p.version { text-align: center; font-size: 11px; color: #7f8c8d; margin: 0 0 10px; }

    /* Leave Form */
    #leaveForm {
      display: flex; flex-wrap: wrap; gap: 8px; padding: 10px; background: #ecf0f1; border-radius: 6px; margin-bottom: 10px;
    }
    #leaveForm label {
      font-weight: 600; margin-right: 4px; color: #34495e;
    }
    #leaveForm input {
      padding: 5px 8px; border: 1px solid #bdc3c7; border-radius: 4px; font-size: 13px; width: 120px;
    }
    #leaveForm input::placeholder { color: #95a5a6; }
    #leaveForm button {
      padding: 6px 12px; background: #3498db; color: #fff; border: none; border-radius: 4px; cursor: pointer; transition: background 0.2s;
    }
    #leaveForm button:hover { background: #2980b9; }

    /* Team Buttons */
    .team-buttons {
      text-align: center; margin: 8px 0;
    }
    .team-buttons button {
      padding: 5px 10px; margin: 0 4px; border: none; border-radius: 4px; color: #fff; cursor: pointer; font-size: 12px;
    }
    .team-a { background: #27ae60; }
    .team-b { background: #2980b9; }
    .team-c { background: #8e44ad; }
    .team-buttons button:hover { opacity: 0.85; }

    /* Month Navigation */
    .month-nav {
      display: flex; justify-content: center; align-items: center; gap: 8px; margin: 8px 0;
    }
    .month-nav button {
      padding: 4px 10px; background: #7f8c8d; color: #fff; border: none; border-radius: 4px; cursor: pointer;
    }
    .month-nav button:hover { background: #6c7a89; }
    #monthLabel { font-weight: 600; color: #2c3e50; }

    /* Calendar */
    #calendarGrid {
      display: grid; grid-template-columns: repeat(7, 1fr); gap: 3px; max-width: 850px; margin: 0 auto 10px;
    }
    .day-cell {
      background: #fff; border: 1px solid #e0e0e0; min-height: 60px; padding: 3px; border-radius: 4px; font-size: 11px;
    }
    .shift-box {
      font-weight: 600; color: #fff; padding: 2px 4px; border-radius: 3px; text-align: center; margin-bottom: 3px;
    }
    .shift-morning { background: #27ae60; }
    .shift-night { background: #a9dfbf; color: #2c3e50; }
    .shift-off { background: #dcdcdc; color: #7f8c8d; }
    .leave-entry {
      background: #fff3cd; padding: 2px 4px; border-radius: 3px; margin: 1px 0;
    }
    .leave-entry.approved { background: #d4edda; font-weight: 600; }
    .leave-entry.rejected { background: #f8d7da; color: #721c24; text-decoration: line-through; }
    .leave-entry.management { background: #ffeeba; }
    .red-dot {
      width: 6px; height: 6px; background: #e74c3c; border-radius: 50%; position: absolute; top: 3px; right: 3px;
    }

    /* Admin Summary */
    #adminSummary {
      padding: 10px; border-radius: 6px; background: #fff; max-height: 300px; overflow-y: auto;
    }
    #adminSummary h3 { font-size: 15px; margin: 0 0 8px; color: #2c3e50; }
    #adminTable {
      width: 100%; border-collapse: collapse; font-size: 12px;
    }
    #adminTable th {
      background: #34495e; color: #fff; padding: 6px; position: sticky; top: 0; z-index: 1;
    }
    #adminTable td {
      border: 1px solid #e0e0e0; padding: 4px; vertical-align: middle;
    }
    #adminTable select {
      padding: 2px; font-size: 11px; border-radius: 3px; width: 100px; border: 1px solid #bdc3c7;
    }
    #adminTable button {
      padding: 3px 6px; font-size: 11px; border: none; border-radius: 3px; cursor: pointer;
    }
    .delete-btn { background: #e74c3c; color: #fff; }
    .delete-btn:hover { background: #c0392b; }
    .whatsapp-btn { background: #25D366; color: #fff; }
    .whatsapp-btn:hover { background: #20b958; }

    .footer {
      text-align: center; font-size: 10px; color: #95a5a6; margin-top: 10px;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>Staff Leave Booking</h1>
  <p class="version">v3.0 — Enhanced UI & Compact Admin View</p>

  <!-- Leave Form -->
  <form id="leaveForm">
    <label for="staffName">Name</label>
    <input type="text" id="staffName" placeholder="Enter full name" required>

    <label for="staffID">ID</label>
    <input type="text" id="staffID" placeholder="e.g., S123" required>

    <label for="startDate">From</label>
    <input type="date" id="startDate" required>

    <label for="endDate">To</label>
    <input type="date" id="endDate" required>

    <button type="submit">Request Leave</button>
  </form>

  <!-- Team Buttons -->
  <div class="team-buttons">
    <button class="team-a" onclick="selectTeam(1)">Team A</button>
    <button class="team-b" onclick="selectTeam(2)">Team B</button>
    <button class="team-c" onclick="selectTeam(3)">Team C</button>
  </div>

  <!-- Month Navigation -->
  <div class="month-nav">
    <button onclick="prevMonth()">←</button>
    <span id="monthLabel">Loading...</span>
    <button onclick="nextMonth()">→</button>
  </div>

  <div id="calendarGrid"></div>

  <!-- Admin Summary -->
  <div id="adminSummary">
    <h3>Pending Leave Requests</h3>
    <table id="adminTable">
      <thead>
        <tr>
          <th>Staff Name</th>
          <th>Staff ID</th>
          <th>From</th>
          <th>To</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="adminList"></tbody>
    </table>
  </div>

  <div class="footer">
    © 2025. Optimized for 30+ users with table-based admin view.
  </div>
</div>

<script>
// Shift Patterns
var TeamPatterns = {
  1: ["morning", "morning", "night", "night", "off", "off"],
  2: ["off", "off", "morning", "morning", "night", "night"],
  3: ["night", "night", "off", "off", "morning", "morning"]
};
var selectedTeam = 1;
var referenceDate = new Date(2025, 2, 1);
var requests = [];
var currentYear = 2025, currentMonth = 2;

function daysBetween(a, b) {
  var A = Date.UTC(a.getFullYear(), a.getMonth(), a.getDate());
  var B = Date.UTC(b.getFullYear(), b.getMonth(), b.getDate());
  return Math.floor((B - A) / (1000 * 60 * 60 * 24));
}

function formatDate(d) {
  var y = d.getFullYear();
  var m = String(d.getMonth() + 1).padStart(2, "0");
  var dd = String(d.getDate()).padStart(2, "0");
  return y + "-" + m + "-" + dd;
}

function getShift(d) {
  var diff = daysBetween(referenceDate, d);
  var idx = ((diff % 6) + 6) % 6;
  return TeamPatterns[selectedTeam][idx];
}

function renderCalendar() {
  var monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
  document.getElementById("monthLabel").textContent = monthNames[currentMonth] + " " + currentYear;

  var grid = document.getElementById("calendarGrid");
  grid.innerHTML = "";
  var firstDay = new Date(currentYear, currentMonth, 1);
  var offset = (firstDay.getDay() + 6) % 7;
  var daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

  for (var i = 0; i < offset; i++) {
    grid.appendChild(document.createElement("div")).className = "day-cell";
  }

  for (var d = 1; d <= daysInMonth; d++) {
    var dateObj = new Date(currentYear, currentMonth, d);
    var dateStr = formatDate(dateObj);
    var cell = document.createElement("div");
    cell.className = "day-cell";

    var shift = getShift(dateObj);
    var shiftBox = document.createElement("div");
    shiftBox.className = "shift-box " + (shift === "morning" ? "shift-morning" : shift === "night" ? "shift-night" : "shift-off");
    shiftBox.textContent = d;
    cell.appendChild(shiftBox);

    var dayEntries = [];
    requests.forEach(req => {
      req.days.forEach(day => {
        if (day.date === dateStr) {
          dayEntries.push({ staffName: req.staffName, staffID: req.staffID, status: day.status });
        }
      });
    });

    if (dayEntries.filter(e => e.status !== "Rejected").length > 2) {
      cell.appendChild(document.createElement("div")).className = "red-dot";
    }

    dayEntries.forEach(e => {
      var entry = document.createElement("div");
      entry.className = "leave-entry " + (e.status === "Approved" ? "approved" : e.status === "Rejected" ? "rejected" : e.status === "Management" ? "management" : "");
      entry.textContent = e.staffName + " (" + e.staffID + ")";
      cell.appendChild(entry);
    });

    grid.appendChild(cell);
  }
  renderAdmin();
}

function renderAdmin() {
  var adminList = document.getElementById("adminList");
  adminList.innerHTML = "";

  requests.forEach((req, i) => {
    var row = document.createElement("tr");
    row.innerHTML = `
      <td>${req.staffName}</td>
      <td>${req.staffID}</td>
      <td>${req.fromDate}</td>
      <td>${req.toDate}</td>
      <td>
        <select data-req="${i}">
          <option value="Pending" ${req.days.every(d => d.status === "Pending") ? "selected" : ""}>Pending</option>
          <option value="Approved" ${req.days.every(d => d.status === "Approved") ? "selected" : ""}>Approved</option>
          <option value="Rejected" ${req.days.every(d => d.status === "Rejected") ? "selected" : ""}>Rejected</option>
          <option value="Management" ${req.days.every(d => d.status === "Management") ? "selected" : ""}>Management</option>
        </select>
      </td>
      <td>
        <button class="delete-btn" data-del="${i}">Delete</button>
        <button class="whatsapp-btn" data-ws="${i}">WhatsApp</button>
      </td>
    `;
    adminList.appendChild(row);
  });

  adminList.querySelectorAll("select").forEach(sel => {
    sel.onchange = function() {
      var reqIndex = sel.getAttribute("data-req");
      requests[reqIndex].days.forEach(day => day.status = sel.value);
      renderCalendar();
    };
  });

  adminList.querySelectorAll(".delete-btn").forEach(btn => {
    btn.onclick = function() {
      var i = btn.getAttribute("data-del");
      requests.splice(i, 1);
      renderCalendar();
    };
  });

  adminList.querySelectorAll(".whatsapp-btn").forEach(btn => {
    btn.onclick = function() {
      var i = btn.getAttribute("data-ws");
      var req = requests[i];
      var msg = `Hello ${req.staffName} (${req.staffID}), your leave status:\nFrom ${req.fromDate} to ${req.toDate}: ${req.days[0].status}`;
      window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, "_blank");
    };
  });
}

function selectTeam(num) {
  selectedTeam = num;
  renderCalendar();
}

document.getElementById("leaveForm").onsubmit = function(e) {
  e.preventDefault();
  var name = document.getElementById("staffName").value.trim();
  var id = document.getElementById("staffID").value.trim();
  var start = document.getElementById("startDate").value;
  var end = document.getElementById("endDate").value;

  if (!name || !id || !start || !end) { alert("Please fill all fields."); return; }
  if (end < start) { alert("End date cannot be before start date."); return; }

  var d = new Date(start);
  var endDate = new Date(end);
  var dayArr = [];
  while (d <= endDate) {
    dayArr.push({ date: formatDate(d), status: "Pending" });
    d.setDate(d.getDate() + 1);
  }

  requests.push({ staffName: name, staffID: id, fromDate: start, toDate: end, days: dayArr });
  e.target.reset();
  renderCalendar();
  alert("Leave request submitted successfully.");
};

function prevMonth() {
  currentMonth--;
  if (currentMonth < 0) { currentMonth = 11; currentYear--; }
  renderCalendar();
}

function nextMonth() {
  currentMonth++;
  if (currentMonth > 11) { currentMonth = 0; currentYear++; }
  renderCalendar();
}

document.addEventListener("DOMContentLoaded", renderCalendar);
</script>
</body>
</html>