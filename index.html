<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Leave Booking System</title>
<style>
  body { font-family:Arial,sans-serif; background:#f5f5f5; margin:20px }
  h1,h2 { text-align:center; color:#333 }

  /* ---------- STAFF AREA ---------- */
  #staffArea { max-width:600px; margin:auto; background:#fff; padding:15px; border-radius:8px; box-shadow:0 1px 3px rgba(0,0,0,0.1) }
  #staffArea form { display:flex; flex-wrap:wrap; gap:10px; }
  #staffArea label { font-weight:bold }
  #staffArea input, #staffArea button { padding:8px; font-size:14px }
  #staffArea button { background:#4CAF50; color:#fff; border:none; border-radius:4px }

  /* ---------- CALENDAR AREA ---------- */
  .planner-container { display:flex; flex-direction:column; border:2px solid #999; background:#fff }
  .weekday-row { display:flex; background:#ddd }
  .weekday-header { flex:1; text-align:center; padding:8px; border:1px solid #bbb; font-weight:bold }
  .calendar-row { display:flex }
  .calendar-cell {
    flex:1;
    display:flex;
    flex-direction:column;
    border:1px solid #bbb;
    padding:4px;
    box-sizing:border-box;
  }
  .calendar-cell.flagged { border:2px solid #ff0000; background:#ffdcdc }

  /* Slim date/shift block */
  .shift-block {
    padding:4px 6px;
    font-size:12px;
    font-weight:bold;
    border-radius:3px;
    margin-bottom:2px;
    text-align:center;
  }
  .shift-block.morning { background:#006400; color:#fff }
  .shift-block.night   { background:#90EE90; color:#000 }
  .shift-block.off     { background:#ccc }
  .shift-block.other-month { background:#eee; color:#888 }

  .leave-info {
    background:#fff8dc;
    border:1px solid #ddd;
    border-radius:4px;
    padding:4px;
    margin-bottom:4px;
    font-size:12px;
  }
  .leave-info.flagged { background:#ffdcdc; border-color:#ff0000 }

  /* ---------- SHIFT BUTTONS ---------- */
  #shiftButtons { display:flex; justify-content:center; gap:10px; margin:10px 0 }
  .Team-btn { padding:6px 12px; background:#4CAF50; color:#fff; border:none; border-radius:20px; cursor:pointer }
  .Team-btn:hover { background:#45a049 }

  /* ---------- SUMMARY TABLES ---------- */
  table { width:100%; border-collapse:collapse; margin-top:10px }
  th, td { border:1px solid #ccc; padding:8px; text-align:left }
  .action-btn { padding:4px 8px; border:none; border-radius:3px; color:#fff; cursor:pointer }
  .approve { background:#4CAF50 }
  .reject  { background:#FF4444 }
  .delete-btn { background:#888 }
</style>
</head>
<body>

<h1>Leave Booking System</h1>

<section id="staffArea">
  <h2>Staff Area</h2>
  <form id="staffDataForm">
    <div style="flex:1">
      <label for="staffName">Name</label>
      <input type="text" id="staffName" required>
    </div>
    <div style="flex:1">
      <label for="staffID">ID</label>
      <input type="text" id="staffID" required>
    </div>
    <div style="flex-basis:100%; text-align:center">
      <button type="submit">Save</button>
    </div>
  </form>
  <form id="leaveRequestForm" style="margin-top:20px">
    <h3>Submit Leave Request</h3>
    <div style="flex:1">
      <label for="startDate">Start</label>
      <input type="date" id="startDate" required>
    </div>
    <div style="flex:1">
      <label for="endDate">End</label>
      <input type="date" id="endDate" required>
    </div>
    <div style="flex-basis:100%; text-align:center; margin-top:10px">
      <button type="submit">Submit</button>
    </div>
  </form>
</section>

<section id="calendarArea">
  <div class="month-navigation">
    <div class="month-header">
      <span class="nav-arrow" onclick="prevMonth()">‹</span>
      <span class="month-title" id="monthTitle"></span>
      <span class="nav-arrow" onclick="nextMonth()">›</span>
    </div>
    <div id="shiftButtons">
      <button class="Team-btn" onclick="selectTeam(1)">Team A</button>
      <button class="Team-btn" onclick="selectTeam(2)">Team B</button>
      <button class="Team-btn" onclick="selectTeam(3)">Team C</button>
    </div>
  </div>
  <div class="planner-container" id="plannerContainer"></div>
</section>

<section id="managerSummary">
  <h2>Manager Summary</h2>
  <div id="adminSummary"></div>
</section>

<section id="staffSummary">
  <h2>Staff Summary</h2>
  <div id="staffSummaryDiv"></div>
</section>

<script>
// ** STAFF DATA & LEAVE REQUEST **
document.getElementById('staffDataForm').addEventListener('submit', e=>{
  e.preventDefault();
  localStorage.setItem('staffData', JSON.stringify({
    name: document.getElementById('staffName').value,
    id: document.getElementById('staffID').value
  }));
  alert('Saved.');
});

document.getElementById('leaveRequestForm').addEventListener('submit', e=>{
  e.preventDefault();
  const start = document.getElementById('startDate').value;
  const end = document.getElementById('endDate').value;
  if(start> end) return alert('Invalid dates');
  const staff = JSON.parse(localStorage.getItem('staffData'));
  if(!staff) return alert('Save staff first.');
  const reqs = JSON.parse(localStorage.getItem('leaveRequests')||'[]');
  reqs.push({ id:Date.now().toString(), staffName:staff.name, staffID:staff.id, startDate:start, endDate:end, status:'pending' });
  localStorage.setItem('leaveRequests', JSON.stringify(reqs));
  renderCalendar(currentYear,currentMonth);
  renderManagerSummary();
  renderStaffSummary();
  e.target.reset();
});

// ** SHIFT PATTERN **
const TeamPatterns = { 1:['morning','morning','night','night','off','off'], 2:['off','off','morning','morning','night','night'], 3:['night','night','off','off','morning','morning'] };
const referenceDate = new Date(2025,2,1);
let selectedTeam=1;
function getShift(date){
  const diff=Math.floor((Date.UTC(date.getFullYear(),date.getMonth(),date.getDate()) - Date.UTC(referenceDate.getFullYear(),referenceDate.getMonth(),referenceDate.getDate()))/(1000*60*60*24));
  return TeamPatterns[selectedTeam][((diff%6)+6)%6];
}
function selectTeam(n){ selectedTeam=n; renderCalendar(currentYear,currentMonth); }

// ** CALENDAR RENDERING **
let currentYear=2025, currentMonth=2;
const monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];

function formatDate(d){ return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`; }

function renderCalendar(year,month){
  document.getElementById('monthTitle').textContent=`${monthNames[month]} ${year}`;
  const container=document.getElementById('plannerContainer'); container.innerHTML='';
  const header=document.createElement('div'); header.className='weekday-row';
  ['MON','TUE','WED','THU','FRI','SAT','SUN'].forEach(day=>{ const e=document.createElement('div'); e.className='weekday-header'; e.textContent=day; header.appendChild(e); });
  container.appendChild(header);

  const firstDay=new Date(year,month,1);
  const startDay= firstDay.getDay()===0?6:firstDay.getDay()-1;
  const daysInMonth=new Date(year,month+1,0).getDate();
  const prevDays=new Date(year,month,0).getDate();
  const totalCells=Math.ceil((startDay+daysInMonth)/7)*7;
  const requests=JSON.parse(localStorage.getItem('leaveRequests')||'[]');
  let day=1,row;

  for(let i=0;i<totalCells;i++){
    if(i%7===0){ row=document.createElement('div'); row.className='calendar-row'; container.appendChild(row) }
    const cell=document.createElement('div'); cell.className='calendar-cell';

    if(i<startDay){
      const num=prevDays-startDay+i+1;
      const block=document.createElement('div'); block.className='shift-block other-month'; block.textContent=num;
      cell.appendChild(block);
    }
    else if(day<=daysInMonth){
      const dateObj=new Date(year,month,day), iso=formatDate(dateObj);
      const shift=getShift(dateObj);
      const block=document.createElement('div'); block.className=`shift-block ${shift}`; block.textContent=day;
      cell.appendChild(block);

      const dayReqs=requests.filter(r=>iso>=r.startDate && iso<=r.endDate);
      if(dayReqs.length>2) cell.classList.add('flagged');
      dayReqs.forEach((r,idx)=>{
        const info=document.createElement('div'); info.className='leave-info'+(idx>=2?' flagged':''); info.textContent=`${r.staffName} (${r.staffID})`;
        cell.appendChild(info);
      });
      day++;
    } else {
      const num=i-startDay-daysInMonth+1;
      const block=document.createElement('div'); block.className='shift-block other-month'; block.textContent=num;
      cell.appendChild(block);
    }
    row.appendChild(cell);
  }
}

function prevMonth(){ currentMonth--; if(currentMonth<0){currentMonth=11; currentYear--} renderCalendar(currentYear,currentMonth); renderManagerSummary(); renderStaffSummary(); }
function nextMonth(){ currentMonth++; if(currentMonth>11){currentMonth=0; currentYear++} renderCalendar(currentYear,currentMonth); renderManagerSummary(); renderStaffSummary(); }

// ** MANAGER SUMMARY **
function renderManagerSummary(){
  const admin=document.getElementById('adminSummary'), reqs=JSON.parse(localStorage.getItem('leaveRequests')||'[]');
  if(!reqs.length){ admin.innerHTML='<p>No leave requests</p>'; return }
  let html=`<table><thead><tr><th>Staff</th><th>Start</th><th>End</th><th>Status</th><th>Actions</th></tr></thead><tbody>`;
  reqs.forEach(r=>{
    html+=`<tr><td>${r.staffName} (${r.staffID})</td><td>${r.startDate}</td><td>${r.endDate}</td><td>${r.status}</td><td>`;
    if(r.status==='pending') html+=`<button class="action-btn approve" onclick="updateStatus('${r.id}','approved')">Approve</button><button class="action-btn reject" onclick="updateStatus('${r.id}','rejected')">Reject</button>`;
    html+=`<button class="delete-btn" onclick="deleteRequest('${r.id}')">Delete</button></td></tr>`;
  });
  admin.innerHTML=html+'</tbody></table>';
}
function updateStatus(id,status){ const arr=JSON.parse(localStorage.getItem('leaveRequests')||'[]'); const idx=arr.findIndex(x=>x.id===id); if(idx>-1){arr[idx].status=status; localStorage.setItem('leaveRequests',JSON.stringify(arr)); renderCalendar(currentYear,currentMonth); renderManagerSummary(); renderStaffSummary()} }
function deleteRequest(id){ const arr=JSON.parse(localStorage.getItem('leaveRequests')||'[]').filter(x=>x.id!==id); localStorage.setItem('leaveRequests',JSON.stringify(arr)); renderCalendar(currentYear,currentMonth); renderManagerSummary(); renderStaffSummary(); }

// ** STAFF SUMMARY **
function renderStaffSummary(){
  const div=document.getElementById('staffSummaryDiv'), reqs=JSON.parse(localStorage.getItem('leaveRequests')||'[]');
  const groups=reqs.reduce((g,r)=>{ (g[r.staffID]||(g[r.staffID]={name:r.staffName,reqs:[]})).reqs.push(r); return g },{});
  let html=`<table><thead><tr><th>Staff</th><th>WhatsApp</th></tr></thead><tbody>`;
  Object.entries(groups).forEach(([id,data])=>{ html+=`<tr><td>${data.name} (${id})</td><td><button onclick="sendWhatsApp('${id}','${data.name}')">WhatsApp</button></td></tr>` });
  div.innerHTML=html+'</tbody></table>';
}
function sendWhatsApp(id,name){
  const arr=JSON.parse(localStorage.getItem('leaveRequests')||'[]').filter(x=>x.staffID===id);
  if(!arr.length) return alert('No leave found');
  let msg=`Hello ${name} (${id}), your leave summary:\n`;
  arr.forEach(r=> msg+=`- ${r.startDate} to ${r.endDate} (${r.status})\n`);
  window.open('https://api.whatsapp.com/send?text='+encodeURIComponent(msg));
}

// ** INITIALIZE **
renderCalendar(currentYear,currentMonth);
renderManagerSummary();
renderStaffSummary();
</script>
</body>
</html>